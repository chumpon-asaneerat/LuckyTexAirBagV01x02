# D365_CP_BPO

**Procedure Number**: 263 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Cutting/Printing Batch Production Order data for D365 ERP sync |
| **Operation** | SELECT |
| **Tables** | Cutting/Printing production order table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_ITEMLOT` | VARCHAR2(50) | âœ… | Item lot number (production identifier) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `PRODID` | NUMBER | Production order ID in D365 |
| `LOTNO` | VARCHAR2(50) | Lot number (batch identifier) |
| `ITEMID` | VARCHAR2(50) | Item ID (cut/printed fabric) in D365 ERP |
| `LOADINGTYPE` | VARCHAR2(50) | Loading type code |
| `QTY` | NUMBER | Quantity produced |
| `UNIT` | VARCHAR2(50) | Unit of measure (e.g., 'PCS' for pieces) |
| `OPERATION` | VARCHAR2(50) | Operation code (e.g., 'CUT' or 'PRINT') |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Cutting/Printing Batch Production Order data for D365 ERP synchronization. The Batch Production Order (BPO) is the foundational transaction that creates a production order in D365 for cutting and printing operations. Cutting is the process of cutting inspected fabric into specific sizes/patterns, and printing adds customer logos or identification marks.

The procedure:
1. Takes item lot number to identify the production
2. Returns production order details for D365 sync
3. Includes item code (cut/printed fabric type), quantity, operation type
4. Provides machine start time for production tracking
5. Must be synced FIRST before any material consumption (ISH/ISL) or output (OPH/OPL) transactions

**Note**: Cutting/Printing procedures use only P_ITEMLOT (single parameter) because these are final production steps with simpler tracking requirements compared to upstream processes.

Part of the D365 integration pattern: BPO â†’ ISH/ISL â†’ OPH/OPL â†’ OUH/OUL

---

## Related Procedures

**Downstream**:
- [264-D365_CP_ISH.md](./264-D365_CP_ISH.md) - Material consumption header
- [265-D365_CP_ISL.md](./265-D365_CP_ISL.md) - Material consumption lines
- [266-D365_CP_OPH.md](./266-D365_CP_OPH.md) - Production output header
- [267-D365_CP_OPL.md](./267-D365_CP_OPL.md) - Production output lines

**Similar**:
- [255-D365_IN_BPO.md](./255-D365_IN_BPO.md) - Inspection BPO (upstream process)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_CP_BPO(D365_CP_BPOParameter para)`
**Lines**: 34853-34900

---

**File**: 263/296 | **Progress**: 88.9%
