# D365_FN_ISL

**Procedure Number**: 250 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Finishing Issue Line details for D365 ERP material consumption detail sync |
| **Operation** | SELECT |
| **Tables** | Finishing material issue detail table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_FINISHINGLOT` | VARCHAR2(50) | âœ… | Finishing lot number (production identifier) |
| `P_WEAVINGLOT` | VARCHAR2(50) | âœ… | Weaving lot number (source fabric identifier) |
| `P_PROCESS` | VARCHAR2(50) | âœ… | Finishing process type (COATING/SCOURING/DRYER) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `LINENO` | NUMBER | Issue line sequence number |
| `ISSUEDATE` | DATE | Material issue date/time |
| `ITEMID` | VARCHAR2(50) | Item ID (greige fabric or chemicals) in D365 |
| `STYLEID` | VARCHAR2(50) | Style/variant ID |
| `QTY` | NUMBER | Quantity issued (consumed) |
| `UNIT` | VARCHAR2(50) | Unit of measure |
| `SERIALID` | VARCHAR2(50) | Serial/batch ID for traceability |

---

## Business Logic (What it does and why)

Retrieves Finishing material Issue Line details for D365 ERP synchronization. Issue Lines are the detail records showing each material consumed in the finishing process - greige fabric input and chemicals (coating agents, cleaning solutions, etc.). Each line represents one material consumption with complete traceability through serial ID.

The procedure:
1. Takes finishing lot, weaving lot, and process type to identify the production
2. Returns all issue line items for this production and process
3. Each line shows which material was consumed (ITEMID, SERIALID)
4. Includes both fabric input and chemical consumption
5. Quantity, unit, and issue date/time for each material
6. Used to post material consumption transactions in D365
7. Enables backward traceability (which greige fabric/chemicals went into this finished fabric)

Synced after Issue Header (ISH) is posted to D365.

---

## Related Procedures

**Upstream**:
- [249-D365_FN_ISH.md](./249-D365_FN_ISH.md) - Issue header (must sync first)

**Related**:
- [248-D365_FN_BPO.md](./248-D365_FN_BPO.md) - Batch production order

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_FN_ISL(D365_FN_ISLParameter para)`
**Lines**: 34123-34168

---

**File**: 250/296 | **Progress**: 84.5%
