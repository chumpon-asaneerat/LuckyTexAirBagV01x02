# D365_FN_OUH

**Procedure Number**: 253 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Finishing Output Update Header for D365 ERP output corrections/updates |
| **Operation** | SELECT |
| **Tables** | Finishing production output update header table |
| **Called From** | D365DataService.cs |
| **Frequency** | Medium (ERP sync - corrections only) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_FINISHINGLOT` | VARCHAR2(50) | âœ… | Finishing lot number (production identifier) |
| `P_WEAVINGLOT` | VARCHAR2(50) | âœ… | Weaving lot number (source fabric identifier) |
| `P_PROCESS` | VARCHAR2(50) | âœ… | Finishing process type (COATING/SCOURING/DRYER) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `HEADERID` | NUMBER | Output update header ID |
| `TOTALRECORD` | NUMBER | Total number of update line records |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Finishing production Output Update Header data for D365 ERP synchronization. This procedure handles corrections or updates to previously synced production output data. Update Header represents the summary of all output corrections/changes that need to be synced back to D365.

The procedure:
1. Takes finishing lot, weaving lot, and process type to identify the production
2. Returns output update header ID for this production and process
3. Provides total count of update line items
4. Includes machine start time for reference
5. Header must be synced before update lines (OUL)

Used when production output data changes after initial sync (e.g., quality reclassification after final inspection, quantity adjustments after re-measurement, fabric grade changes).

---

## Related Procedures

**Downstream**:
- [254-D365_FN_OUL.md](./254-D365_FN_OUL.md) - Output update lines (detail records)

**Related**:
- [251-D365_FN_OPH.md](./251-D365_FN_OPH.md) - Original output header
- [252-D365_FN_OPL.md](./252-D365_FN_OPL.md) - Original output lines

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_FN_OUH(D365_FN_OUHParameter para)`
**Lines**: 34275-34316

---

**File**: 253/296 | **Progress**: 85.5%
