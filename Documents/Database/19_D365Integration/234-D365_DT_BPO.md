# D365_DT_BPO

**Procedure Number**: 234 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Drawing Batch Production Order data for D365 ERP sync |
| **Operation** | SELECT |
| **Tables** | Drawing production order table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_BEAMLOT` | VARCHAR2(50) | âœ… | Beam lot number (production identifier) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `PRODID` | NUMBER | Production order ID in D365 |
| `LOTNO` | VARCHAR2(50) | Lot number (batch identifier) |
| `ITEMID` | VARCHAR2(50) | Item ID in D365 ERP system |
| `LOADINGTYPE` | VARCHAR2(50) | Loading type code |
| `QTY` | NUMBER | Quantity produced |
| `UNIT` | VARCHAR2(50) | Unit of measure |
| `OPERATION` | VARCHAR2(50) | Operation code (typically 'DRAW') |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Drawing Batch Production Order data for D365 ERP synchronization. The Batch Production Order (BPO) is the foundational transaction that creates a production order in D365 for drawing operations. Drawing is the process of pulling weaver's beam yarn through heddles and reed to create the proper warp sheet configuration for weaving.

The procedure:
1. Takes beam lot number (production identifier)
2. Returns production order details for D365 sync
3. Includes item code, quantity, operation type
4. Provides machine start time for production tracking
5. Must be synced FIRST before any material consumption (ISH/ISL) or output (OPH/OPL) transactions

Part of the D365 integration pattern: BPO â†’ ISH/ISL â†’ OPH/OPL â†’ OUH/OUL

---

## Related Procedures

**Downstream**:
- [235-D365_DT_ISH.md](./235-D365_DT_ISH.md) - Material consumption header
- [236-D365_DT_ISL.md](./236-D365_DT_ISL.md) - Material consumption lines
- [237-D365_DT_OPH.md](./237-D365_DT_OPH.md) - Production output header

**Similar**:
- [220-D365_WP_BPO.md](./220-D365_WP_BPO.md) - Warping BPO (same pattern)
- [227-D365_BM_BPO.md](./227-D365_BM_BPO.md) - Beaming BPO (same pattern)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_DT_BPO(D365_DT_BPOParameter para)`
**Lines**: 33265-33312

---

**File**: 234/296 | **Progress**: 79.1%
