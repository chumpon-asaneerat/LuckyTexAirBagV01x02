# D365_GR_OPH

**Procedure Number**: 244 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Weaving (Greige) Output Header for D365 ERP production output sync |
| **Operation** | SELECT |
| **Tables** | Weaving production output header table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_WEAVINGLOT` | VARCHAR2(50) | âœ… | Weaving lot number (production identifier) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `HEADERID` | NUMBER | Output header ID |
| `TOTALRECORD` | NUMBER | Total number of output line records |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Weaving production Output Header data for D365 ERP synchronization. Output Header represents the summary of all production output (greige fabric rolls produced) for this weaving production lot. The header must be synced to D365 before individual output lines (OPL).

The procedure:
1. Takes weaving lot number (production identifier)
2. Returns output header ID for this lot
3. Provides total count of output line items (fabric rolls/doffs)
4. Includes machine start time for production tracking
5. Header synced first, then lines (OPL) are synced with this header ID

**Note**: Output tracking uses only weaving lot number (unlike BPO/ISH/ISL which use multiple parameters) because output is aggregated at the lot level, not by individual doff or loom.

Part of D365 integration pattern: BPO â†’ ISH/ISL â†’ **OPH** â†’ OPL

---

## Related Procedures

**Upstream**:
- [241-D365_GR_BPO.md](./241-D365_GR_BPO.md) - Batch production order
- [242-D365_GR_ISH.md](./242-D365_GR_ISH.md) - Issue header
- [243-D365_GR_ISL.md](./243-D365_GR_ISL.md) - Issue lines

**Downstream**:
- [245-D365_GR_OPL.md](./245-D365_GR_OPL.md) - Output lines (production detail)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_GR_OPH(D365_GR_OPHParameter para)`
**Lines**: 33797-33838

---

**File**: 244/296 | **Progress**: 82.4%
