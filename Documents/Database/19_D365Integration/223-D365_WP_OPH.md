# D365_WP_OPH

**Procedure Number**: 223 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Warping Output Header data for D365 ERP production output sync |
| **Operation** | SELECT |
| **Tables** | Warping production output header table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_WARPHEADNO` | VARCHAR2(50) | âœ… | Warp header number (lot number) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `HEADERID` | NUMBER | Output header ID |
| `TOTALRECORD` | NUMBER | Total number of output line records |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Warping production Output Header data for D365 ERP synchronization. Output Header represents the summary of all warp beams produced during warping operation. This is the header record that groups multiple output line items (OPL).

The procedure:
1. Takes warp header number
2. Returns output header ID for this production lot
3. Provides total count of output line items (warp beams)
4. Includes machine start time for transaction timestamp
5. Header must be synced before output lines (OPL)

Part of production reporting in D365 - shows warp beams produced as output.

---

## Related Procedures

**Downstream**:
- [224-D365_WP_OPL.md](./224-D365_WP_OPL.md) - Output lines (detail records)

**Related**:
- [220-D365_WP_BPO.md](./220-D365_WP_BPO.md) - Batch production order
- [221-D365_WP_ISH.md](./221-D365_WP_ISH.md) - Input (material consumption)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\Services\DataService\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\Domains\AirbagSPs.cs`
**Method**: `D365_WP_OPH(D365_WP_OPHParameter para)`
**Lines**: 32563-32604

---

**File**: 223/296 | **Progress**: 75.3%
