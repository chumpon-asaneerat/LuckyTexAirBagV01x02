# D365_IN_BPO

**Procedure Number**: 255 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Inspection Batch Production Order data for D365 ERP sync |
| **Operation** | SELECT |
| **Tables** | Inspection production order table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_FINISHINGLOT` | VARCHAR2(50) | âœ… | Finishing lot number (source fabric identifier) |
| `P_INSPECTIONLOT` | VARCHAR2(50) | âœ… | Inspection lot number (production identifier) |
| `P_STARTDATE` | DATE | âœ… | Inspection start date |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `PRODID` | NUMBER | Production order ID in D365 |
| `LOTNO` | VARCHAR2(50) | Lot number (batch identifier) |
| `ITEMID` | VARCHAR2(50) | Item ID (inspected fabric) in D365 ERP |
| `LOADINGTYPE` | VARCHAR2(50) | Loading type code |
| `QTY` | NUMBER | Quantity inspected (fabric length) |
| `UNIT` | VARCHAR2(50) | Unit of measure (e.g., 'M' for meters) |
| `OPERATION` | VARCHAR2(50) | Operation code (e.g., 'INSPECT') |
| `MACHINESTART` | DATE | Machine/inspection start timestamp |

---

## Business Logic (What it does and why)

Retrieves Inspection Batch Production Order data for D365 ERP synchronization. The Batch Production Order (BPO) is the foundational transaction that creates a production order in D365 for inspection operations. Inspection is the quality control process where finished fabric is examined for defects, measured, graded, and certified before final packaging.

The procedure:
1. Takes finishing lot, inspection lot, and start date to identify the inspection
2. Returns production order details for D365 sync
3. Includes item code (inspected fabric type), quantity, operation type
4. Provides inspection start time for production tracking
5. Must be synced FIRST before any material consumption (ISH/ISL) or output (OPH/OPL) transactions

**Note**: Inspection procedures use finishing lot + inspection lot + start date for precise tracking of which finished fabric batch is being inspected and when.

Part of the D365 integration pattern: BPO â†’ ISH/ISL â†’ OPH/OPL â†’ OUH/OUL

---

## Related Procedures

**Downstream**:
- [256-D365_IN_ISH.md](./256-D365_IN_ISH.md) - Material consumption header
- [257-D365_IN_ISL.md](./257-D365_IN_ISL.md) - Material consumption lines
- [258-D365_IN_OPH.md](./258-D365_IN_OPH.md) - Production output header
- [259-D365_IN_OPL.md](./259-D365_IN_OPL.md) - Production output lines

**Similar**:
- [248-D365_FN_BPO.md](./248-D365_FN_BPO.md) - Finishing BPO (upstream process)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_IN_BPO(D365_IN_BPOParameter para)`
**Lines**: 34399-34446

---

**File**: 255/296 | **Progress**: 86.1%
