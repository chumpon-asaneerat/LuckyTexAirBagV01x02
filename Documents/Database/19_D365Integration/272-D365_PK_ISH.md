# D365_PK_ISH

**Procedure Number**: 272 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Packing Issue Header for D365 ERP material consumption sync |
| **Operation** | SELECT |
| **Tables** | Packing material issue header table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_PALLETNO` | VARCHAR2(50) | âœ… | Pallet number (shipping identifier) |
| `P_ITEMCODE` | VARCHAR2(50) | âœ… | Item code (packed product identifier) |
| `P_LOADINGTYPE` | VARCHAR2(50) | âœ… | Loading type code (customer/order specific) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `HEADERID` | NUMBER | Issue header ID |
| `TOTALRECORD` | NUMBER | Total number of issue line records |
| `MACHINESTART` | DATE | Packing start timestamp |

---

## Business Logic (What it does and why)

Retrieves Packing material Issue Header data for D365 ERP synchronization. Issue Header represents the summary of all material consumption (cut/printed fabric consumed for packing) for this pallet/order. The header must be synced to D365 before individual issue lines (ISL or ISL_C).

The procedure:
1. Takes pallet number, item code, and loading type to identify the packing operation
2. Returns issue header ID for this packing lot
3. Provides total count of issue line items
4. Includes packing start time for production tracking
5. Header synced first, then lines (ISL or ISL_C) are synced with this header ID

**Note**: This ISH procedure is SHARED by both standard (BPO) and variant C (BPO_C) packing processes.

Part of D365 integration pattern: BPO/BPO_C â†’ **ISH** â†’ ISL/ISL_C â†’ OUH/OUH_C â†’ OUL/OUL_C

---

## Related Procedures

**Upstream**:
- [270-D365_PK_BPO.md](./270-D365_PK_BPO.md) - Standard packing BPO
- [271-D365_PK_BPO_C.md](./271-D365_PK_BPO_C.md) - Variant C packing BPO

**Downstream**:
- [273-D365_PK_ISL.md](./273-D365_PK_ISL.md) - Issue lines (standard)
- [274-D365_PK_ISL_C.md](./274-D365_PK_ISL_C.md) - Issue lines (variant C)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_PK_ISH(D365_PK_ISHParameter para)`
**Lines**: 35339-35380

---

**File**: 272/296 | **Progress**: 91.9%
