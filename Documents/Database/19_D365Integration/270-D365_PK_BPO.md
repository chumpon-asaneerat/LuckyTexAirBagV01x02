# D365_PK_BPO

**Procedure Number**: 270 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Packing Batch Production Order data for D365 ERP sync |
| **Operation** | SELECT |
| **Tables** | Packing production order table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_PALLETNO` | VARCHAR2(50) | âœ… | Pallet number (shipping identifier) |
| `P_ITEMCODE` | VARCHAR2(50) | âœ… | Item code (packed product identifier) |
| `P_LOADINGTYPE` | VARCHAR2(50) | âœ… | Loading type code (customer/order specific) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `PRODID` | NUMBER | Production order ID in D365 |
| `LOTNO` | VARCHAR2(50) | Lot number (batch identifier) |
| `ITEMID` | VARCHAR2(50) | Item ID (packed product) in D365 ERP |
| `LOADINGTYPE` | VARCHAR2(50) | Loading type code |
| `QTY` | NUMBER | Quantity packed |
| `UNIT` | VARCHAR2(50) | Unit of measure (e.g., 'ROLL', 'PCS') |
| `OPERATION` | VARCHAR2(50) | Operation code (e.g., 'PACK') |
| `MACHINESTART` | DATE | Packing start timestamp |

---

## Business Logic (What it does and why)

Retrieves Packing Batch Production Order data for D365 ERP synchronization. The Batch Production Order (BPO) is the foundational transaction that creates a production order in D365 for packing operations. Packing is the final production step where cut/printed fabric is packaged onto pallets for customer shipment.

The procedure:
1. Takes pallet number, item code, and loading type to identify the packing operation
2. Returns production order details for D365 sync
3. Includes item code (packed product type), quantity, operation type
4. Provides packing start time for production tracking
5. Must be synced FIRST before any material consumption (ISH/ISL) or output (OUH/OUL) transactions

**Note**: Packing procedures use 3 parameters (pallet + item + loading type) because packing is customer-order specific and tracks final shipping units.

Part of the D365 integration pattern: BPO â†’ ISH/ISL â†’ OUH/OUL (no OPH/OPL for packing)

---

## Related Procedures

**Downstream**:
- [272-D365_PK_ISH.md](./272-D365_PK_ISH.md) - Material consumption header
- [273-D365_PK_ISL.md](./273-D365_PK_ISL.md) - Material consumption lines

**Similar**:
- [271-D365_PK_BPO_C.md](./271-D365_PK_BPO_C.md) - Packing BPO variant C

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_PK_BPO(D365_PK_BPOParameter para)`
**Lines**: 35231-35278

---

**File**: 270/296 | **Progress**: 91.2%
