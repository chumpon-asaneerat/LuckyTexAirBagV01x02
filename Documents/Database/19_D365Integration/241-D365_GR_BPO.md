# D365_GR_BPO

**Procedure Number**: 241 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Weaving (Greige) Batch Production Order data for D365 ERP sync |
| **Operation** | SELECT |
| **Tables** | Weaving production order table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_BEAMLOT` | VARCHAR2(50) | âœ… | Beam lot number (warp beam identifier) |
| `P_LOOMNO` | VARCHAR2(50) | âœ… | Loom machine number |
| `P_DOFFNO` | NUMBER | âœ… | Doff number (fabric roll sequence) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `PRODID` | NUMBER | Production order ID in D365 |
| `LOTNO` | VARCHAR2(50) | Lot number (batch identifier) |
| `ITEMID` | VARCHAR2(50) | Item ID (greige fabric) in D365 ERP |
| `LOADINGTYPE` | VARCHAR2(50) | Loading type code |
| `QTY` | NUMBER | Quantity produced (fabric length) |
| `UNIT` | VARCHAR2(50) | Unit of measure (e.g., 'M' for meters) |
| `OPERATION` | VARCHAR2(50) | Operation code (typically 'WEAVE' or 'GR') |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Weaving (Greige production) Batch Production Order data for D365 ERP synchronization. The Batch Production Order (BPO) is the foundational transaction that creates a production order in D365 for weaving operations. Weaving is the core manufacturing process where warp and weft yarns are interlaced to create greige (unfinished) fabric.

The procedure:
1. Takes beam lot, loom number, and doff number to uniquely identify the production
2. Returns production order details for D365 sync
3. Includes item code (fabric type), quantity, operation type
4. Provides machine start time for production tracking
5. Must be synced FIRST before any material consumption (ISH/ISL) or output (OPH/OPL) transactions

**Note**: This procedure uses 3 input parameters (unlike Warping/Beaming/Drawing which use 1) because weaving requires tracking the specific loom and doff number in addition to the beam lot.

Part of the D365 integration pattern: BPO â†’ ISH/ISL â†’ OPH/OPL â†’ OUH/OUL

---

## Related Procedures

**Downstream**:
- D365_GR_ISH - Material consumption header (next file)
- D365_GR_ISL - Material consumption lines
- D365_GR_OPH - Production output header
- D365_GR_OPL - Production output lines

**Similar**:
- [220-D365_WP_BPO.md](./220-D365_WP_BPO.md) - Warping BPO
- [227-D365_BM_BPO.md](./227-D365_BM_BPO.md) - Beaming BPO
- [234-D365_DT_BPO.md](./234-D365_DT_BPO.md) - Drawing BPO

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_GR_BPO(D365_GR_BPOParameter para)`
**Lines**: 33643-33690

---

**File**: 241/296 | **Progress**: 81.4%
