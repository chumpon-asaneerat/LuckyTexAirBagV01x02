# D365_PK_OUL

**Procedure Number**: 277 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Packing Output Update Line details for D365 ERP output corrections/updates |
| **Operation** | SELECT |
| **Tables** | Packing production output update detail table |
| **Called From** | D365DataService.cs |
| **Frequency** | Medium (ERP sync - corrections only) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_PALLETNO` | VARCHAR2(50) | âœ… | Pallet number (shipping identifier) |
| `P_ITEMCODE` | VARCHAR2(50) | âœ… | Item code (packed product identifier) |
| `P_LOADINGTYPE` | VARCHAR2(50) | âœ… | Loading type code (customer/order specific) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `LINENO` | NUMBER | Update line sequence number |
| `OUTPUTDATE` | DATE | Output/packing date |
| `ITEMID` | VARCHAR2(50) | Item ID (packed product) in D365 |
| `QTY` | NUMBER | Quantity (updated value) |
| `UNIT` | VARCHAR2(50) | Unit of measure |
| `GROSSLENGTH` | NUMBER | Gross length (meters, with waste) |
| `NETLENGTH` | NUMBER | Net length (meters, usable) |
| `GROSSWEIGHT` | NUMBER | Gross weight (kg, with packaging) |
| `NETWEIGHT` | NUMBER | Net weight (kg, product only) |
| `PALLETNO` | VARCHAR2(50) | Pallet number for storage/shipping |
| `GRADE` | VARCHAR2(50) | Quality grade (A, B, C, etc.) |
| `LOADINGTYPE` | VARCHAR2(50) | Loading type code |
| `SERIALID` | VARCHAR2(50) | Serial/batch ID for traceability |
| `FINISH` | NUMBER | Finish status flag |
| `MOVEMENTTRANS` | VARCHAR2(50) | Movement transaction type |
| `WAREHOUSE` | VARCHAR2(50) | Warehouse location code |
| `LOCATION` | VARCHAR2(50) | Specific location within warehouse |

---

## Business Logic (What it does and why)

Retrieves Packing production Output Update Line details for D365 ERP synchronization. This procedure handles corrections or updates to previously synced packing output line data. Update Lines contain the corrected/updated information for each packed pallet, including quantity changes, quality reclassification, or location updates.

The procedure:
1. Takes pallet number, item code, and loading type to identify the packing operation
2. Returns all output update line items for this packing lot
3. Each line has updated values for quantity, quality grade, weights, lengths
4. Includes warehouse location and movement transaction data
5. Used to post output correction transactions in D365
6. Maintains full traceability through serial ID

Synced after Output Update Header (OUH) is posted to D365. Used for standard packing process (BPO). Common scenarios: pallet quantity adjustments, shipping corrections, warehouse location updates before dispatch.

---

## Related Procedures

**Upstream**:
- [275-D365_PK_OUH.md](./275-D365_PK_OUH.md) - Output update header (must sync first)

**Similar**:
- [278-D365_PK_OUL_C.md](./278-D365_PK_OUL_C.md) - Variant C version

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_PK_OUL(D365_PK_OULParameter para)`
**Lines**: 35587-35656

---

**File**: 277/296 | **Progress**: 93.6%
