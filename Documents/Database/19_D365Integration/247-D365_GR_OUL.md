# D365_GR_OUL

**Procedure Number**: 247 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Weaving (Greige) Output Update Line details for D365 ERP output corrections/updates |
| **Operation** | SELECT |
| **Tables** | Weaving production output update detail table |
| **Called From** | D365DataService.cs |
| **Frequency** | Medium (ERP sync - corrections only) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_BEAMLOT` | VARCHAR2(50) | âœ… | Beam lot number (warp beam identifier) |
| `P_WEAVINGLOT` | VARCHAR2(50) | âœ… | Weaving lot number (production identifier) |
| `P_DOFFNO` | NUMBER | âœ… | Doff number (fabric roll sequence) |
| `P_LOOMNO` | VARCHAR2(50) | âœ… | Loom machine number |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `LINENO` | NUMBER | Update line sequence number |
| `OUTPUTDATE` | DATE | Output/production date |
| `ITEMID` | VARCHAR2(50) | Item ID (greige fabric) in D365 |
| `QTY` | NUMBER | Quantity (updated value - fabric length) |
| `UNIT` | VARCHAR2(50) | Unit of measure (typically 'M' for meters) |
| `GROSSLENGTH` | NUMBER | Gross length (meters, with waste) |
| `NETLENGTH` | NUMBER | Net length (meters, usable) |
| `GROSSWEIGHT` | NUMBER | Gross weight (kg, with packaging) |
| `NETWEIGHT` | NUMBER | Net weight (kg, product only) |
| `PALLETNO` | VARCHAR2(50) | Pallet number for storage/shipping |
| `GRADE` | VARCHAR2(50) | Quality grade (A, B, C, etc.) |
| `LOADINGTYPE` | VARCHAR2(50) | Loading type code |
| `SERIALID` | VARCHAR2(50) | Serial/batch ID for traceability |
| `FINISH` | NUMBER | Finish status flag |
| `MOVEMENTTRANS` | VARCHAR2(50) | Movement transaction type |
| `WAREHOUSE` | VARCHAR2(50) | Warehouse location code |
| `LOCATION` | VARCHAR2(50) | Specific location within warehouse |

---

## Business Logic (What it does and why)

Retrieves Weaving production Output Update Line details for D365 ERP synchronization. This procedure handles corrections or updates to previously synced production output line data. Update Lines contain the corrected/updated information for each greige fabric roll, including quantity changes, quality reclassification, or location updates.

The procedure:
1. Takes beam lot, weaving lot, doff number, and loom number to identify the specific fabric roll
2. Returns all output update line items for this production
3. Each line has updated values for quantity, quality grade, weights, lengths
4. Includes warehouse location and movement transaction data
5. Used to post output correction transactions in D365
6. Maintains full traceability through serial ID

**Note**: This procedure uses 4 input parameters (same as D365_GR_ISL) because weaving output updates require precise identification of the specific fabric roll by beam lot, weaving lot, doff number, AND loom number.

Synced after Output Update Header (OUH) is posted to D365. Common scenarios: quality downgrade after inspection, quantity adjustment after remeasurement, grade change from A to B, location change after warehouse movement.

---

## Related Procedures

**Upstream**:
- [246-D365_GR_OUH.md](./246-D365_GR_OUH.md) - Output update header (must sync first)

**Related**:
- [244-D365_GR_OPH.md](./244-D365_GR_OPH.md) - Original output header
- [245-D365_GR_OPL.md](./245-D365_GR_OPL.md) - Original output lines

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_GR_OUL(D365_GR_OULParameter para)`
**Lines**: 33945-34014

---

**File**: 247/296 | **Progress**: 83.4%
