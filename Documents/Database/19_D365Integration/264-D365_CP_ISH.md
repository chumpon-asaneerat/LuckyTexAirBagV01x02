# D365_CP_ISH

**Procedure Number**: 264 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Cutting/Printing Issue Header for D365 ERP material consumption sync |
| **Operation** | SELECT |
| **Tables** | Cutting/Printing material issue header table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_ITEMLOT` | VARCHAR2(50) | âœ… | Item lot number (production identifier) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `HEADERID` | NUMBER | Issue header ID |
| `TOTALRECORD` | NUMBER | Total number of issue line records |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Cutting/Printing material Issue Header data for D365 ERP synchronization. Issue Header represents the summary of all material consumption (inspected fabric consumed for cutting/printing) for this item lot. The header must be synced to D365 before individual issue lines (ISL).

The procedure:
1. Takes item lot number to identify the production
2. Returns issue header ID for this lot
3. Provides total count of issue line items
4. Includes machine start time for production tracking
5. Header synced first, then lines (ISL) are synced with this header ID

Part of D365 integration pattern: BPO â†’ **ISH** â†’ ISL â†’ OPH/OPL

---

## Related Procedures

**Upstream**:
- [263-D365_CP_BPO.md](./263-D365_CP_BPO.md) - Batch production order (must sync first)

**Downstream**:
- [265-D365_CP_ISL.md](./265-D365_CP_ISL.md) - Issue lines (material detail)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_CP_ISH(D365_CP_ISHParameter para)`
**Lines**: 34907-34948

---

**File**: 264/296 | **Progress**: 89.2%
