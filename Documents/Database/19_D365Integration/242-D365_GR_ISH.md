# D365_GR_ISH

**Procedure Number**: 242 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Weaving (Greige) Issue Header for D365 ERP material consumption sync |
| **Operation** | SELECT |
| **Tables** | Weaving material issue header table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_BEAMLOT` | VARCHAR2(50) | âœ… | Beam lot number (warp beam identifier) |
| `P_WEAVINGLOT` | VARCHAR2(50) | âœ… | Weaving lot number (production identifier) |
| `P_DOFFNO` | NUMBER | âœ… | Doff number (fabric roll sequence) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `HEADERID` | NUMBER | Issue header ID |
| `TOTALRECORD` | NUMBER | Total number of issue line records |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Weaving material Issue Header data for D365 ERP synchronization. Issue Header represents the summary of all material consumption (warp beams and weft yarn consumed) for this weaving production lot. The header must be synced to D365 before individual issue lines (ISL).

The procedure:
1. Takes beam lot, weaving lot, and doff number to identify the production
2. Returns issue header ID for this production
3. Provides total count of issue line items
4. Includes machine start time for production tracking
5. Header synced first, then lines (ISL) are synced with this header ID

**Note**: Weaving procedures use multiple parameters (beam lot + weaving lot + doff) because weaving tracks both warp (beam) and weft (yarn) material consumption separately.

Part of D365 integration pattern: BPO â†’ **ISH** â†’ ISL â†’ OPH/OPL

---

## Related Procedures

**Upstream**:
- [241-D365_GR_BPO.md](./241-D365_GR_BPO.md) - Batch production order (must sync first)

**Downstream**:
- [243-D365_GR_ISL.md](./243-D365_GR_ISL.md) - Issue lines (material detail)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_GR_ISH(D365_GR_ISHParameter para)`
**Lines**: 33697-33738

---

**File**: 242/296 | **Progress**: 81.8%
