# D365_GR_OPL

**Procedure Number**: 245 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Weaving (Greige) Output Line details for D365 ERP production output detail sync |
| **Operation** | SELECT |
| **Tables** | Weaving production output detail table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_WEAVINGLOT` | VARCHAR2(50) | âœ… | Weaving lot number (production identifier) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `LINENO` | NUMBER | Output line sequence number |
| `PROCQTY` | NUMBER | Process quantity (fabric length in meters) |
| `OPRNO` | VARCHAR2(50) | Operation number in D365 |
| `OPRID` | VARCHAR2(50) | Operator ID who performed operation |
| `MACHINENO` | VARCHAR2(50) | Machine number (loom) used for production |
| `STARTDATETIME` | DATE | Operation start date/time |
| `ENDDATETIME` | DATE | Operation end date/time |

---

## Business Logic (What it does and why)

Retrieves Weaving production Output Line details for D365 ERP synchronization. Output Lines are the detail records showing each greige fabric roll (doff) produced, including operator, loom, time tracking, and quantity information. Each line represents one fabric roll output with complete traceability.

The procedure:
1. Takes weaving lot number (production identifier)
2. Returns all output line items for this lot
3. Each line has quantity (fabric length), operator, loom number, timestamps
4. Used to post production output transactions in D365
5. Enables production performance tracking (time, quantity per doff, efficiency by loom/operator)

Synced after Output Header (OPH) is posted to D365.

---

## Related Procedures

**Upstream**:
- [244-D365_GR_OPH.md](./244-D365_GR_OPH.md) - Output header (must sync first)

**Related**:
- [241-D365_GR_BPO.md](./241-D365_GR_BPO.md) - Batch production order

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_GR_OPL(D365_GR_OPLParameter para)`
**Lines**: 33845-33890

---

**File**: 245/296 | **Progress**: 82.8%
