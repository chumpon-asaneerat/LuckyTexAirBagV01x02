# D365_GR_ISL

**Procedure Number**: 243 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Weaving (Greige) Issue Line details for D365 ERP material consumption detail sync |
| **Operation** | SELECT |
| **Tables** | Weaving material issue detail table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_BEAMLOT` | VARCHAR2(50) | âœ… | Beam lot number (warp beam identifier) |
| `P_WEAVINGLOT` | VARCHAR2(50) | âœ… | Weaving lot number (production identifier) |
| `P_DOFFNO` | NUMBER | âœ… | Doff number (fabric roll sequence) |
| `P_LOOMNO` | VARCHAR2(50) | âœ… | Loom machine number |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `LINENO` | NUMBER | Issue line sequence number |
| `ISSUEDATE` | DATE | Material issue date/time |
| `ITEMID` | VARCHAR2(50) | Item ID (warp beam or weft yarn) in D365 |
| `STYLEID` | VARCHAR2(50) | Style/variant ID |
| `QTY` | NUMBER | Quantity issued (consumed) |
| `UNIT` | VARCHAR2(50) | Unit of measure |
| `SERIALID` | VARCHAR2(50) | Serial/batch ID for traceability |

---

## Business Logic (What it does and why)

Retrieves Weaving material Issue Line details for D365 ERP synchronization. Issue Lines are the detail records showing each material consumed in the weaving process - both warp beams and weft yarn. Each line represents one material consumption with complete traceability through serial ID.

The procedure:
1. Takes beam lot, weaving lot, doff number, and loom number to identify the production
2. Returns all issue line items for this production
3. Each line shows which material was consumed (ITEMID, SERIALID)
4. Includes both warp (beam) and weft (yarn) consumption
5. Quantity, unit, and issue date/time for each material
6. Used to post material consumption transactions in D365
7. Enables backward traceability (which beams/yarns went into this fabric)

**Note**: This procedure uses 4 input parameters (most of all D365 procedures) because weaving tracks beam lot, weaving lot, doff number, AND loom number for precise material tracking.

Synced after Issue Header (ISH) is posted to D365.

---

## Related Procedures

**Upstream**:
- [242-D365_GR_ISH.md](./242-D365_GR_ISH.md) - Issue header (must sync first)

**Related**:
- [241-D365_GR_BPO.md](./241-D365_GR_BPO.md) - Batch production order

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_GR_ISL(D365_GR_ISLParameter para)`
**Lines**: 33745-33790

---

**File**: 243/296 | **Progress**: 82.1%
