# D365_IN_ISH

**Procedure Number**: 256 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Inspection Issue Header for D365 ERP material consumption sync |
| **Operation** | SELECT |
| **Tables** | Inspection material issue header table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_FINISHINGLOT` | VARCHAR2(50) | âœ… | Finishing lot number (source fabric identifier) |
| `P_INSPECTIONLOT` | VARCHAR2(50) | âœ… | Inspection lot number (production identifier) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `HEADERID` | NUMBER | Issue header ID |
| `TOTALRECORD` | NUMBER | Total number of issue line records |
| `MACHINESTART` | DATE | Inspection start timestamp |

---

## Business Logic (What it does and why)

Retrieves Inspection material Issue Header data for D365 ERP synchronization. Issue Header represents the summary of all material consumption (finished fabric consumed/input for inspection) for this inspection lot. The header must be synced to D365 before individual issue lines (ISL).

The procedure:
1. Takes finishing lot and inspection lot to identify the inspection
2. Returns issue header ID for this inspection
3. Provides total count of issue line items
4. Includes inspection start time for production tracking
5. Header synced first, then lines (ISL) are synced with this header ID

Part of D365 integration pattern: BPO â†’ **ISH** â†’ ISL â†’ OPH/OPL

---

## Related Procedures

**Upstream**:
- [255-D365_IN_BPO.md](./255-D365_IN_BPO.md) - Batch production order (must sync first)

**Downstream**:
- [257-D365_IN_ISL.md](./257-D365_IN_ISL.md) - Issue lines (material detail)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_IN_ISH(D365_IN_ISHParameter para)`
**Lines**: 34453-34494

---

**File**: 256/296 | **Progress**: 86.5%
