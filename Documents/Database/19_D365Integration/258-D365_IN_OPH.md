# D365_IN_OPH

**Procedure Number**: 258 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Inspection Output Header for D365 ERP production output sync |
| **Operation** | SELECT |
| **Tables** | Inspection production output header table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_INSPECTIONLOT` | VARCHAR2(50) | âœ… | Inspection lot number (production identifier) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `HEADERID` | NUMBER | Output header ID |
| `TOTALRECORD` | NUMBER | Total number of output line records |
| `MACHINESTART` | DATE | Inspection start timestamp |

---

## Business Logic (What it does and why)

Retrieves Inspection production Output Header data for D365 ERP synchronization. Output Header represents the summary of all production output (inspected, graded, and certified fabric) for this inspection lot. The header must be synced to D365 before individual output lines (OPL).

The procedure:
1. Takes inspection lot number to identify the inspection
2. Returns output header ID for this lot
3. Provides total count of output line items (fabric rolls after inspection)
4. Includes inspection start time for production tracking
5. Header synced first, then lines (OPL) are synced with this header ID

**Note**: Inspection output is critical for inventory - fabric is graded (A, B, C) during inspection, affecting sales value and customer allocation.

Part of D365 integration pattern: BPO â†’ ISH/ISL â†’ **OPH** â†’ OPL

---

## Related Procedures

**Upstream**:
- [255-D365_IN_BPO.md](./255-D365_IN_BPO.md) - Batch production order
- [256-D365_IN_ISH.md](./256-D365_IN_ISH.md) - Issue header
- [257-D365_IN_ISL.md](./257-D365_IN_ISL.md) - Issue lines

**Downstream**:
- [259-D365_IN_OPL.md](./259-D365_IN_OPL.md) - Output lines (production detail)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_IN_OPH(D365_IN_OPHParameter para)`
**Lines**: 34553-34594

---

**File**: 258/296 | **Progress**: 87.2%
