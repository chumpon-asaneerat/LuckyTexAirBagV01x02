# D365_FN_ISH

**Procedure Number**: 249 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Finishing Issue Header for D365 ERP material consumption sync |
| **Operation** | SELECT |
| **Tables** | Finishing material issue header table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_FINISHINGLOT` | VARCHAR2(50) | âœ… | Finishing lot number (production identifier) |
| `P_WEAVINGLOT` | VARCHAR2(50) | âœ… | Weaving lot number (source fabric identifier) |
| `P_PROCESS` | VARCHAR2(50) | âœ… | Finishing process type (COATING/SCOURING/DRYER) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `HEADERID` | NUMBER | Issue header ID |
| `TOTALRECORD` | NUMBER | Total number of issue line records |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Finishing material Issue Header data for D365 ERP synchronization. Issue Header represents the summary of all material consumption (greige fabric and chemicals consumed) for this finishing production lot and process. The header must be synced to D365 before individual issue lines (ISL).

The procedure:
1. Takes finishing lot, weaving lot, and process type to identify the production
2. Returns issue header ID for this production and process
3. Provides total count of issue line items
4. Includes machine start time for production tracking
5. Header synced first, then lines (ISL) are synced with this header ID

**Note**: Each finishing process (coating, scouring, drying) has separate material consumption tracking in D365.

Part of D365 integration pattern: BPO â†’ **ISH** â†’ ISL â†’ OPH/OPL

---

## Related Procedures

**Upstream**:
- [248-D365_FN_BPO.md](./248-D365_FN_BPO.md) - Batch production order (must sync first)

**Downstream**:
- [250-D365_FN_ISL.md](./250-D365_FN_ISL.md) - Issue lines (material detail)

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_FN_ISH(D365_FN_ISHParameter para)`
**Lines**: 34075-34116

---

**File**: 249/296 | **Progress**: 84.1%
