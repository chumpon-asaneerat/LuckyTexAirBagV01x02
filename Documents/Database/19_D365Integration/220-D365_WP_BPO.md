# D365_WP_BPO

**Procedure Number**: 220 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Warping Batch Production Order (BPO) data for D365 ERP sync |
| **Operation** | SELECT |
| **Tables** | Warping production header table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_WARPHEADNO` | VARCHAR2(50) | âœ… | Warp header number (lot number) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `PRODID` | NUMBER | Production order ID in D365 |
| `LOTNO` | VARCHAR2(50) | Lot number (warp header number) |
| `ITEMID` | VARCHAR2(50) | Item ID in D365 ERP |
| `LOADINGTYPE` | VARCHAR2(50) | Loading type code |
| `QTY` | NUMBER | Quantity produced |
| `UNIT` | VARCHAR2(10) | Unit of measure |
| `OPERATION` | VARCHAR2(50) | Operation code (WARP) |
| `MACHINESTART` | DATE | Machine start timestamp |

---

## Business Logic (What it does and why)

Retrieves Warping Batch Production Order data for synchronization with Dynamics 365 ERP system. When warping production is completed, this data is sent to D365 to record material consumption, production output, and link to production orders. BPO (Batch Production Order) represents the manufacturing order in D365.

The procedure:
1. Takes warp header number (lot)
2. Looks up production order linkage
3. Returns D365 production ID, quantities, item codes
4. Includes machine start time for production tracking
5. Data used to post production transactions in D365

Part of M19.1 Warping Integration (7 procedures for complete warping-to-ERP sync).

---

## Related Procedures

**Related D365 Warping Integration**:
- [221-D365_WP_ISH.md](./221-D365_WP_ISH.md) - Issue header
- [222-D365_WP_ISL.md](./222-D365_WP_ISL.md) - Issue lines
- [223-D365_WP_OPH.md](./223-D365_WP_OPH.md) - Output header
- [224-D365_WP_OPL.md](./224-D365_WP_OPL.md) - Output lines
- [225-D365_WP_OUH.md](./225-D365_WP_OUH.md) - Output update header
- [226-D365_WP_OUL.md](./226-D365_WP_OUL.md) - Output update lines

---

## Query/Code Location

**Note**: This project uses Oracle stored procedures called from C# DataService classes.

**DataService File**: `LuckyTex.AirBag.Core\Services\DataService\D365DataService.cs`
**Method**: Method name to be confirmed
**Lines**: To be confirmed

**Database Manager File**: `LuckyTex.AirBag.Core\Domains\AirbagSPs.cs`
**Method**: `D365_WP_BPO(D365_WP_BPOParameter para)`
**Lines**: 32711-32754

---

**File**: 220/296 | **Progress**: 74.3%
