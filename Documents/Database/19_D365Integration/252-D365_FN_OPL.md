# D365_FN_OPL

**Procedure Number**: 252 | **Module**: M19 - D365 Integration | **Status**: âœ… ANALYZED

---

## Quick Reference

| Attribute | Value |
|-----------|-------|
| **Purpose** | Get Finishing Output Line details for D365 ERP production output detail sync |
| **Operation** | SELECT |
| **Tables** | Finishing production output detail table |
| **Called From** | D365DataService.cs |
| **Frequency** | High (ERP sync) |
| **Performance** | Fast |
| **Issues** | ðŸŸ¢ None identified |

---

## Parameters

### Input (IN)

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `P_FINISHINGLOT` | VARCHAR2(50) | âœ… | Finishing lot number (production identifier) |
| `P_WEAVINGLOT` | VARCHAR2(50) | âœ… | Weaving lot number (source fabric identifier) |
| `P_PROCESS` | VARCHAR2(50) | âœ… | Finishing process type (COATING/SCOURING/DRYER) |

### Returns (Cursor)

| Column | Type | Description |
|--------|------|-------------|
| `LINENO` | NUMBER | Output line sequence number |
| `PROCQTY` | NUMBER | Process quantity (finished fabric length) |
| `OPRNO` | VARCHAR2(50) | Operation number in D365 |
| `OPRID` | VARCHAR2(50) | Operator ID who performed operation |
| `MACHINENO` | VARCHAR2(50) | Machine number used for production |
| `STARTDATETIME` | DATE | Operation start date/time |
| `ENDDATETIME` | DATE | Operation end date/time |

---

## Business Logic (What it does and why)

Retrieves Finishing production Output Line details for D365 ERP synchronization. Output Lines are the detail records showing each finished fabric roll produced, including operator, machine, time tracking, and quantity information. Each line represents one fabric roll output with complete traceability.

The procedure:
1. Takes finishing lot, weaving lot, and process type to identify the production
2. Returns all output line items for this production and process
3. Each line has quantity (fabric length), operator, machine, timestamps
4. Used to post production output transactions in D365
5. Enables production performance tracking (time, quantity per roll, efficiency by machine/operator/process)

Synced after Output Header (OPH) is posted to D365.

---

## Related Procedures

**Upstream**:
- [251-D365_FN_OPH.md](./251-D365_FN_OPH.md) - Output header (must sync first)

**Related**:
- [248-D365_FN_BPO.md](./248-D365_FN_BPO.md) - Batch production order

---

## Query/Code Location

**DataService File**: `LuckyTex.AirBag.Core\\Services\\DataService\\D365DataService.cs`

**Database Manager File**: `LuckyTex.AirBag.Core\\Domains\\AirbagSPs.cs`
**Method**: `D365_FN_OPL(D365_FN_OPLParameter para)`
**Lines**: 34223-34268

---

**File**: 252/296 | **Progress**: 85.1%
